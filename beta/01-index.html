<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ConciergeSync‚Ñ¢ Console</title>

<!-- Gate: require auth -->
<script>
(function () {
  try {
    const isAuthed =
      sessionStorage.getItem('cs_authed') === '1' ||
      localStorage.getItem('cs_authed') === '1' ||
      /(?:^|;\s*)cs_auth=1(?:;|$)/.test(document.cookie);

    if (!isAuthed) location.replace('/beta/auth.html?mode=login');
  } catch {
    location.replace('/beta/auth.html?mode=login');
  }
})();
</script>

<style>
  :root{
    --glass-bg: rgba(255,255,255,.12);
    --glass-border: rgba(255,255,255,.28);
    --overlay-grad-top: rgba(0,0,0,.35);
    --overlay-grad-bot: rgba(0,0,0,.58);
    --overlay: .30;
    --vh: 100vh;
    --ui: 4000;
    --ease: cubic-bezier(.22,1,.36,1);
    --t-fast: 220ms;
    --t: 640ms;
    --t-out: 900ms;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    color:#eef2f8;
    background:#0b0f14;
  }

  /* Backdrop */
  .backdrop{ position:fixed; inset:0; z-index:0; overflow:hidden; }
  .backdrop-image{
    position:absolute; inset:0;
    background:center/cover no-repeat;
    filter: brightness(1.12) contrast(1.05);
    transform: scale(1.03) translateZ(0);
    will-change: transform, opacity, filter;
    transition: opacity 600ms ease, transform 900ms ease, filter 900ms ease;
    opacity:.999;
  }
  .backdrop-overlay{
    position:absolute; inset:0; pointer-events:none;
    background: linear-gradient(to bottom, var(--overlay-grad-top), var(--overlay-grad-bot));
    opacity: var(--overlay);
  }

  /* Tabs bar */
  .cs-tabs{
    position: fixed; top: 18px; left: 50%; transform: translateX(-50%);
    z-index: var(--ui);
    display:flex; gap:10px; padding:10px 12px;
    background: rgba(15,15,18,.36);
    border:1px solid rgba(255,255,255,.25);
    border-radius:14px; backdrop-filter: blur(8px) saturate(1.1);
  }
  .cs-tab{
    padding:10px 14px; border-radius:10px; border:1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.07); color:#fff; font-weight:700; cursor:pointer;
  }
  .cs-tab:hover{ background: rgba(255,255,255,.12); }
  a.cs-tab{text-decoration:none;}

  /* Exit button */
  .console-exit{
    position:fixed; top:18px; right:18px; z-index:var(--ui);
    width:40px; height:40px; border-radius:10px;
    border:1px solid rgba(255,255,255,.35);
    background: rgba(20,20,20,.45);
    color:#fff; font-size:28px; line-height:36px; text-align:center; cursor:pointer;
    backdrop-filter: blur(8px) saturate(1.1);
  }
  .console-exit:hover{ background: rgba(20,20,20,.6); }

  /* Stage */
  #cs-tiles{ position: fixed; inset: 0; z-index: 10; pointer-events: none; }

  /* Tiles */
  .cs-tile{
    position:absolute;
    width:420px;
    min-height:320px;
    max-height:76vh;
    display:grid; grid-template-rows:auto 1fr;
    background:var(--glass-bg);
    border:1px solid var(--glass-border);
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,.22);
    backdrop-filter:blur(12px) saturate(1.22);
    overflow:hidden;
    pointer-events:auto;
    user-select:none;
    touch-action: pan-y;
  }
  .cs-tile-head{display:flex;justify-content:space-between;align-items:center;
    padding:12px 14px;background:rgba(0,0,0,.18);border-bottom:1px solid rgba(255,255,255,.18);}
  .cs-tile-head h4{margin:0;font-size:15px;font-weight:800;}
  .cs-close{cursor:pointer;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);
    border-radius:8px;width:30px;height:30px;color:#fff;text-align:center;}
  .cs-tile-body{padding:14px;overflow:auto;}
</style>
</head>
<body class="console-mode">

<div class="backdrop"><div class="backdrop-image" id="backdropImage"></div><div class="backdrop-overlay"></div></div>

<div class="cs-tabs">
  <button class="cs-tab" data-key="overview">Overview</button>
  <button class="cs-tab" data-key="itinerary">Itinerary</button>
  <button class="cs-tab" data-key="values">Value Calc</button>
  <button class="cs-tab" data-key="tools">User Tools</button>
</div>

<button id="exitFs" class="console-exit">√ó</button>
<div id="cs-tiles"></div>

<script>
(function(){
  const BG='/beta/assets/bg/dfw-hero.jpg';
  document.getElementById('backdropImage').style.backgroundImage=`url("${BG}")`;

  const stage=document.getElementById('cs-tiles');let zTop=10;

  const forms={
    sec1:"https://noteforms.com/forms/beta-user-tracker-conciergesync-b4yxaf",
    sec2:"https://noteforms.com/forms/section-2-authorized-user-card-setup-conciergesync-xnkw5k",
    sec3:"https://noteforms.com/forms/section-3-loyalty-program-overview-40ya0y",
    sec4:"https://noteforms.com/forms/section-4-transferable-points-programs-wp4ujy"
  };
  const UID_GUID="78ddd51d-9ccb-4fc7-a3cd-d17f7cd37ff4";

  function wireEditLinks(scope){
    const root=scope||document;
    const uid=localStorage.getItem('cs_uid')||"";
    const email=localStorage.getItem('cs_email')||"";
    const first=localStorage.getItem('cs_first')||"";
    const last=localStorage.getItem('cs_last')||"";

    Object.entries(forms).forEach(([k,url])=>{
      const a=root.querySelector(`#link-${k}`);
      if(!a) return;
      if(!uid){a.href="/beta/auth.html?mode=login";return;}
      const u=new URL(url);
      u.searchParams.set("uid",uid);
      u.searchParams.set(UID_GUID,uid);
      if(email)u.searchParams.set("email",email);
      if(first)u.searchParams.set("first",first);
      if(last)u.searchParams.set("last",last);
      a.href=u.toString();
      a.target="_blank";a.rel="noopener";
    });
  }

  const TEMPLATES={
    overview:()=>`<header class="cs-tile-head"><h4>Overview</h4><div class="cs-close">√ó</div></header>
      <div class="cs-tile-body"><p>Overview content</p></div>`,
    itinerary:()=>`<header class="cs-tile-head"><h4>Itinerary</h4><div class="cs-close">√ó</div></header>
      <div class="cs-tile-body"><p>Trips and dates</p></div>`,
    values:()=>`<header class="cs-tile-head"><h4>Value Calc</h4><div class="cs-close">√ó</div></header>
      <div class="cs-tile-body"><p>CPP and transfer hints</p></div>`,
    tools:()=>`<header class="cs-tile-head"><h4>User Tools</h4><div class="cs-close">√ó</div></header>
      <div class="cs-tile-body">
        <button id="openProfile" class="cs-tab">üóÇÔ∏è Update Profile</button>
      </div>`,
    profile:()=>`<header class="cs-tile-head"><h4>Profile Updates</h4><div class="cs-close">√ó</div></header>
      <div class="cs-tile-body" style="display:flex;flex-direction:column;gap:10px">
        <a id="link-sec1" class="cs-tab">Section 1 ‚Äî Travel Profile</a>
        <a id="link-sec2" class="cs-tab">Section 2 ‚Äî Cards & Users</a>
        <a id="link-sec3" class="cs-tab">Section 3 ‚Äî Loyalty Programs</a>
        <a id="link-sec4" class="cs-tab">Section 4 ‚Äî Points Programs</a>
        <p style="font-size:12px;color:#ccc;margin-top:8px">After submitting, just close the tab to return to Console.</p>
      </div>`
  };

  function centerPos(tile){
    const r=tile.getBoundingClientRect();
    return {x:(window.innerWidth-r.width)/2,y:Math.max(18,(window.innerHeight-r.height)/2)};
  }

  function makeDraggable(tile){
    let isDown=false,startX=0,startY=0,baseX=0,baseY=0;
    tile.addEventListener('pointerdown',e=>{
      if(e.button!==0)return;
      isDown=true;tile.style.zIndex=++zTop;
      startX=e.clientX;startY=e.clientY;
      const r=tile.getBoundingClientRect();baseX=r.left;baseY=r.top;
      e.preventDefault();
    });
    window.addEventListener('pointermove',e=>{
      if(!isDown)return;
      tile.style.left=(baseX+(e.clientX-startX))+'px';
      tile.style.top=(baseY+(e.clientY-startY))+'px';
    });
    window.addEventListener('pointerup',()=>isDown=false);
  }

  function openTile(key){
    const ex=stage.querySelector(\`.cs-tile[data-key="\${key}"]\`);
    if(ex){ex.style.zIndex=++zTop;return;}
    const el=document.createElement('section');
    el.className='cs-tile';el.dataset.key=key;
    el.innerHTML=TEMPLATES[key]?TEMPLATES[key]():'';
    stage.appendChild(el);
    const {x,y}=centerPos(el);el.style.left=x+'px';el.style.top=y+'px';
    makeDraggable(el);
    el.querySelector('.cs-close')?.addEventListener('click',()=>el.remove());
    if(key==='profile')wireEditLinks(el);
    if(key==='tools')el.querySelector('#openProfile').addEventListener('click',()=>openTile('profile'));
  }

  document.querySelectorAll('.cs-tab').forEach(b=>b.addEventListener('click',()=>openTile(b.dataset.key)));
})();
</script>
</body>
</html>
