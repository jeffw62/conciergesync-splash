<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ConciergeSync — Sign in / Register</title>
  <style>
    :root{
      --vh: 100vh;
      --overlay: .30;
      --overlay-grad-top: rgba(0,0,0,.35);
      --overlay-grad-bottom: rgba(0,0,0,.55);

      --ink:#0f172a; --muted:#64748b;
      --ring: 0 0 0 3px rgba(255,255,255,.22);
      --glass-bg: rgba(255,255,255,.12);
      --glass-brd: rgba(255,255,255,.28);
      --glass-blur: blur(12px) saturate(1.2);
      --btn:#111; --btn-text:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:#f5f7fb; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:#000;
    }

    /* Backdrop (same system as console) */
    .backdrop{position:fixed; inset:0; height:var(--vh); overflow:hidden; z-index:0}
    .backdrop-image{
      position:absolute; inset:0; background:center/cover no-repeat;
      filter: brightness(1.12) contrast(1.05) blur(6px); transform: scale(1.03) translateZ(0);
      transition: opacity 600ms ease, transform 900ms ease, filter 900ms ease; opacity:0;
    }
    .backdrop-overlay{
      position:absolute; inset:0; pointer-events:none;
      background: linear-gradient(to bottom, var(--overlay-grad-top), var(--overlay-grad-bottom));
      opacity: var(--overlay); transition: opacity 220ms ease;
    }

    /* Layout */
    .wrap{position:relative; z-index:1; min-height:var(--vh); display:grid; place-items:center; padding:24px}
    .card{
      width:min(840px, 92vw);
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
      backdrop-filter: var(--glass-blur);
      padding: 28px;
    }

    h1{margin:0 0 8px; font-size:32px; text-align:center; letter-spacing:.2px}
    p.lead{margin:0 0 18px; text-align:center; color:#e7e9ef}

    /* Switch */
    .switch{display:flex; gap:8px; justify-content:center; margin:10px 0 22px}
    .switch button{
      padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.10); color:#fff; font-weight:700; cursor:pointer;
      backdrop-filter: blur(6px) saturate(1.1);
    }
    .switch button.active{background:#111; border-color:#111}

    form{display:grid; gap:12px; max-width:560px; margin:0 auto}
    label{font-weight:700; font-size:14px}
    input[type="email"], input[type="text"]{
      width:100%; padding:12px 14px; border-radius:12px;
      background: rgba(255,255,255,.14); color:#fff;
      border:1px solid rgba(255,255,255,.28);
    }
    input::placeholder{color:#dbe0ee}
    input:focus{outline:none; box-shadow:var(--ring); border-color:rgba(255,255,255,.5)}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:6px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 16px; border-radius:12px; border:1px solid var(--btn); background:var(--btn); color:var(--btn-text);
      font-weight:800; cursor:pointer;
    }
    .btn.secondary{background:transparent; color:#fff; border-color:rgba(255,255,255,.6)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}

    .hint{color:#dbe0ee; font-size:13px}
    .legal{color:#cfd6ea; font-size:12px; text-align:center; margin-top:6px}
    .a{color:#fff; text-decoration:underline}

    /* OTP boxes */
    .sep{height:1px; background:rgba(255,255,255,.18); margin:16px 0}
    .otp{display:flex; gap:8px; justify-content:center}
    .otp input{
      width:48px; height:54px; text-align:center; font-size:22px;
      border-radius:12px; border:1px solid rgba(255,255,255,.28); background:rgba(255,255,255,.12); color:#fff;
    }

    @media (max-width:640px){
      .row{grid-template-columns:1fr}
      h1{font-size:26px}
    }
  </style>
<style>
  /* Compact card */
  .auth-card{ max-width:420px; margin:18px auto 0; text-align:left; }

  /* Labels */
  .auth-label{ display:block; margin:12px 0 6px; font-weight:600; color:#fff; text-shadow:0 1px 1px rgba(0,0,0,.28); }

  /* Glass inputs (uniform width/height) */
  .auth-field{
    width:100%; height:44px; padding:10px 14px;
    border-radius:12px; border:1px solid rgba(255,255,255,.35);
    background:rgba(255,255,255,.12); color:#fff;
    backdrop-filter: blur(10px) saturate(1.1); -webkit-backdrop-filter: blur(10px) saturate(1.1);
    box-shadow:0 2px 8px rgba(0,0,0,.18) inset;
  }
  .auth-field::placeholder{ color:rgba(255,255,255,.75); }
  .auth-field:focus{
    outline:none; border-color:rgba(255,255,255,.9);
    box-shadow:0 0 0 3px rgba(255,255,255,.18) inset, 0 6px 18px rgba(0,0,0,.28);
  }

  /* Full-width primary button */
  .auth-btn{
    width:100%; height:46px; margin-top:14px;
    border:0; border-radius:12px; background:#111; color:#fff; font-weight:700;
    box-shadow:0 6px 16px rgba(0,0,0,.18); cursor:pointer; display:block;
  }
  .auth-btn:hover{ transform:translateY(-1px); box-shadow:0 10px 22px rgba(0,0,0,.22); }

  /* Make the Register link a visible glass CTA */
  .auth-cta{
    display:block; text-align:center; margin-top:12px; padding:10px 14px;
    border-radius:12px; border:1px solid rgba(255,255,255,.55);
    background:rgba(0,0,0,.28); color:#fff; text-decoration:none; font-weight:700;
    backdrop-filter: blur(8px) saturate(1.1); -webkit-backdrop-filter: blur(8px) saturate(1.1);
    box-shadow:0 6px 16px rgba(0,0,0,.18);
  }
  .auth-cta:hover{ background:rgba(0,0,0,.4); border-color:rgba(255,255,255,.75); transform:translateY(-1px); }
</style>

</head>
<body>
  <!-- Backdrop -->
  <div class="backdrop">
    <div class="backdrop-image" id="bg"></div>
    <div class="backdrop-overlay"></div>
  </div>

  <div class="wrap">
    <div class="card" role="dialog" aria-labelledby="t">
      <h1 id="t">Welcome To ConciergeSync™</h1>
      <p class="lead">Sign in or create your account with your email.</p>

      <div class="switch" role="tablist" aria-label="Auth mode">
        <!-- Returning user pill -->
        <button id="pillLogin" type="button" class="...">Returning user? Log in</button>
        <!-- New user pill -->
        <button id="pillRegister" type="button" class="...">New user? Register</button>
      </div>

      <!-- LOGIN -->
      <!-- LOGIN (default) -->
<section id="viewLogin" class="auth-card">
  <h2 class="auth-title">Welcome To ConciergeSync™</h2>
  <p>Sign in with your email and password.</p>

  <label class="auth-label" for="loginEmail">Email</label>
  <input id="loginEmail" class="auth-field" type="email" autocomplete="username" required>

  <label class="auth-label" for="loginPassword">Password</label>
  <input id="loginPassword" class="auth-field" type="password" autocomplete="current-password" required>

  <button id="btnLogin" class="auth-btn" type="button">Log in</button>

  <a id="linkShowRegister" class="auth-cta" href="#register">Not a member yet? Register here</a>
</section>
      <section id="viewRegister" class="auth-card" hidden>
  <h2 class="auth-title">Create your ConciergeSync™ account</h2>

  <div style="display:flex; gap:12px">
    <div style="flex:1">
      <label class="auth-label" for="regFirst">First name</label>
      <input id="regFirst"  class="auth-field" type="text" autocomplete="given-name">
    </div>
    <div style="flex:1">
      <label class="auth-label" for="regLast">Last name</label>
      <input id="regLast"   class="auth-field" type="text" autocomplete="family-name">
    </div>
  </div>

  <label class="auth-label" for="regEmail">Email (your LoginID)</label>
  <input id="regEmail" class="auth-field" type="email" autocomplete="username" required>

  <label class="auth-label" for="regPassword">Create a password</label>
  <input id="regPassword" class="auth-field" type="password" autocomplete="new-password" required>

  <label class="auth-label" style="display:flex;gap:8px;align-items:center;margin:10px 0">
    <input id="agreeTos" type="checkbox" required>
    <span>I agree to the <a href="/terms.html" target="_blank">Terms</a> &amp; <a href="/privacy.html" target="_blank">Privacy</a>.</span>
  </label>

  <button id="btnCreate" class="auth-btn" type="button">Create account</button>

  <a id="linkShowLogin" class="auth-cta" href="#login">Already have an account? Log in</a>
</section>
<script>
  // ... you already have viewLogin/viewRegister + showLogin/showRegister + link wires

  document.getElementById('pillLogin')?.addEventListener('click', showLogin);
  document.getElementById('pillRegister')?.addEventListener('click', showRegister);
</script>


<!-- REGISTER (hidden until clicked) -->
<section id="viewRegister" hidden>
  <h1>Create your account</h1>

  <div style="display:flex; gap:12px">
    <div style="flex:1">
      <label>First name</label>
      <input id="firstName" type="text" autocomplete="given-name">
    </div>
    <div style="flex:1">
      <label>Last name</label>
      <input id="lastName" type="text" autocomplete="family-name">
    </div>
  </div>

  <label>Email (your LoginID)</label>
  <input id="regEmail" type="email" autocomplete="username" required>

  <label>Create a password</label>
  <input id="regPassword" type="password" autocomplete="new-password" required>

  <label style="display:flex;gap:8px;align-items:center;margin:10px 0">
    <input id="agreeTos" type="checkbox" required>
    <span>I agree to the <a href="/terms.html" target="_blank">Terms</a> &amp; <a href="/privacy.html" target="_blank">Privacy</a>.</span>
  </label>

  <button id="btnCreate">Create account</button>

  <div style="margin-top:10px">
    <a id="linkShowLogin" href="#login">Already have an account? Log in</a>
  </div>
</section>

<script>
(() => {
  const viewLogin    = document.getElementById('viewLogin');
  const viewRegister = document.getElementById('viewRegister');
  if (!viewLogin || !viewRegister) return;

  const showLogin = (e) => { e?.preventDefault(); viewRegister.hidden = true;  viewLogin.hidden = false; };
  const showRegister = (e) => { e?.preventDefault(); viewLogin.hidden = true; viewRegister.hidden = false; };

  // Bottom links
  document.getElementById('linkShowRegister')?.addEventListener('click', showRegister);
  document.getElementById('linkShowLogin')?.addEventListener('click', showLogin);

  // Top pills
  const pillLogin = document.getElementById('pillLogin');
  const pillRegister = document.getElementById('pillRegister');
  pillLogin?.setAttribute('type','button');
  pillRegister?.setAttribute('type','button');
  pillLogin?.addEventListener('click', showLogin);
  pillRegister?.addEventListener('click', showRegister);
})();
</script>



        <!-- OTP -->
        <div id="otp-wrap" style="display:none">
          <div class="sep"></div>
          <label>Enter the 6-digit code sent to your email</label>
          <div id="otp" class="otp" aria-label="One-time passcode">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
          </div>
          <div class="actions">
            <button class="btn" id="btn-verify" type="button">Verify &amp; continue</button>
            <button class="btn secondary" id="btn-resend" type="button">Resend code</button>
            <span id="otp-msg" class="hint" aria-live="polite"></span>
          </div>
        </div>
      </form>

      <!-- REGISTER -->
      <form id="form-register" style="display:none" autocomplete="on">
        <div class="row">
          <div>
            <label for="reg-first">First name</label>
            <input id="reg-first" name="firstName" type="text" autocomplete="given-name"/>
          </div>
          <div>
            <label for="reg-last">Last name</label>
            <input id="reg-last" name="lastName" type="text" autocomplete="family-name"/>
          </div>
        </div>
        <div>
          <label for="reg-email">Email (your LoginID)</label>
          <input id="reg-email" name="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" required/>
        </div>
        <div>
          <label><input id="reg-tos" type="checkbox" required/> I agree to the <a class="a" href="/legal/terms.html" target="_blank" rel="noopener">Terms</a> &amp; <a class="a" href="/legal/privacy.html" target="_blank" rel="noopener">Privacy</a>.</label>
        </div>
        <div class="actions">
          <button class="btn" id="btn-register" type="submit">Create account</button>
          <span id="reg-msg" class="hint" aria-live="polite"></span>
        </div>
      </form>

      <p class="legal">Protected by rate-limiting and verification. We’ll never share your email.</p>
    </div>
  </div>

  <script>
    // Backdrop (same approach as console)
    (function(){
      const IMAGES = ['/beta/assets/bg/IMG_5374.jpeg'];
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      function setVh(){ document.documentElement.style.setProperty('--vh', window.innerHeight + 'px'); }
      setVh(); addEventListener('resize', setVh);

      const bg = document.getElementById('bg');
      const src = IMAGES[0];
      const img = new Image(); img.crossOrigin = 'anonymous'; img.src = src;
      img.onload = ()=>{ bg.style.backgroundImage = `url("${src}")`; bg.style.opacity = 1; };
    })();

    // ====== Auth logic (same API shim as your console-side code) ======
    const API = {
      start:  '/api/auth/start',   // POST { mode:'login'|'register'|'link', email, profile? }
      verify: '/api/auth/verify',  // POST { tokenId, code }
    };
    const REDIRECT_AFTER_LOGIN = '/beta/02-agree.html?enter=1';

    const $ = (s,r=document)=>r.querySelector(s);
    const tabLogin=$('#tab-login'), tabReg=$('#tab-register');
    const formLogin=$('#form-login'), formReg=$('#form-register');
    function setMode(m){
      const isLogin = m==='login';
      tabLogin.classList.toggle('active', isLogin);
      tabReg.classList.toggle('active', !isLogin);
      formLogin.style.display = isLogin?'':'none';
      formReg.style.display   = isLogin?'none':'';
      (isLogin?$('#login-email'):$('#reg-email'))?.focus();
    }
    tabLogin.onclick=()=>setMode('login'); tabReg.onclick=()=>setMode('register');

    // LOGIN
    const loginMsg=$('#login-msg'), otpWrap=$('#otp-wrap'), otpMsg=$('#otp-msg');
    const otpBoxes = Array.from($('#otp-boxes').querySelectorAll('input'));
    let tokenId=null;

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = ($('#login-email').value||'').trim(); if(!email) return;
      loginMsg.textContent='Sending code…'; $('#btn-send-code').disabled=true;
      try{
        const res = await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'login',email})});
        const data = await res.json(); if(!res.ok || !data?.ok) throw new Error(data?.error||'Failed to send code');
        tokenId=data.tokenId; otpWrap.style.display=''; loginMsg.textContent='Check your email for a 6-digit code.'; otpBoxes[0].focus();
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not send code'); }
      finally{ $('#btn-send-code').disabled=false; }
    });

    $('#btn-use-link').addEventListener('click', async ()=>{
      const email = ($('#login-email').value||'').trim(); if(!email) return alert('Enter your email first.');
      loginMsg.textContent='Sending magic link…';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'link',email})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Failed to send link');
        loginMsg.textContent='Magic link sent — check your inbox.';
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not send link'); }
    });

    otpBoxes.forEach((b,i)=>{
      b.addEventListener('input',e=>{const v=b.value.replace(/\D/g,''); b.value=v.slice(-1); if(v && i<otpBoxes.length-1) otpBoxes[i+1].focus();});
      b.addEventListener('keydown',e=>{ if(e.key==='Backspace' && !b.value && i>0) otpBoxes[i-1].focus(); });
    });
    $('#btn-verify').onclick = async ()=>{
      if(!tokenId) return;
      const code = otpBoxes.map(b=>b.value).join(''); if(code.length!==6) return;
      otpMsg.textContent='Verifying…';
      try{
        const res=await fetch(API.verify,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tokenId,code})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Invalid code');
        location.assign(REDIRECT_AFTER_LOGIN);
      }catch(err){ otpMsg.textContent=''; alert(err.message||'Could not verify code'); }
    };
    $('#btn-resend').onclick = async ()=>{
      const email = ($('#login-email').value||'').trim(); if(!email) return;
      loginMsg.textContent='Resending code…';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'login',email})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Failed to resend code');
        tokenId=data.tokenId; loginMsg.textContent='New code sent.';
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not resend code'); }
    };

    // REGISTER
    formReg.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const first=($('#reg-first').value||'').trim(), last=($('#reg-last').value||'').trim();
      const email=($('#reg-email').value||'').trim(); const agree=$('#reg-tos').checked;
      if(!email || !agree) return;
      $('#btn-register').disabled=true; $('#reg-msg').textContent='Creating your account…';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'register',email,profile:{firstName:first,lastName:last}})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Could not create account');
        tokenId = data.tokenId ?? null;
        if(tokenId){
          // Finish with OTP the same as login:
          setMode('login'); $('#login-email').value=email; otpWrap.style.display=''; $('#login-msg').textContent='We emailed you a sign-in code to complete setup.'; otpBoxes[0].focus();
        }else{
          location.assign(REDIRECT_AFTER_LOGIN);
        }
      }catch(err){ alert(err.message||'Registration failed'); }
      finally{ $('#btn-register').disabled=false; $('#reg-msg').textContent=''; }
    });

    // Deep link: #register opens Register tab
    if(location.hash==='#register') setMode('register');
  </script>
  <!-- ... your LOGIN section (#viewLogin) ... -->
<!-- ... your REGISTER section (#viewRegister) ... -->

<!-- ⬇️ Paste Step 2 toggle script here (plain <script>, not module) -->
<script>
  const viewLogin    = document.getElementById('viewLogin');
  const viewRegister = document.getElementById('viewRegister');

  function showLogin(e){ e?.preventDefault(); viewRegister.hidden = true; viewLogin.hidden = false; }
  function showRegister(e){ e?.preventDefault(); viewLogin.hidden = true; viewRegister.hidden = false; }

  document.getElementById('linkShowRegister')?.addEventListener('click', showRegister);
  document.getElementById('linkShowLogin')?.addEventListener('click', showLogin);

  // Optional: if your top pills exist, give them data-auth="login"/"register" and wire them:
  document.querySelector('button[data-auth="login"]')?.addEventListener('click', showLogin);
  document.querySelector('button[data-auth="register"]')?.addEventListener('click', showRegister);
</script>

<!-- ⬇️ Then your Firebase script (Step 3) comes after this -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    updateProfile
  } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

  // Firebase (public client config is fine here)
  const firebaseConfig = {
    apiKey: "AIzaSyCcqBQtV3e1hGRMzBa_k5trNRqL0UmlByE",
    authDomain: "conciergesync.firebaseapp.com",
    projectId: "conciergesync",
    storageBucket: "conciergesync.firebasestorage.app",
    messagingSenderId: "882907448780",
    appId: "1:882907448780:web:6e797ce9ad5bb84a9f8969"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // NoteForms Section-1 (your exact keys)
  const S1_URL       = "https://noteforms.com/forms/beta-user-tracker-conciergesync-b4yxaf";
  const S1_EMAIL_KEY = "aafd8404-ef8a-4b17-ab3d-15e2357e93a5";
  const S1_UID_KEY   = "78ddd51d-9ccb-4fc7-a3cd-d17f7cd37ff4";
  const EXTRA_PARAM  = "b4eb726e-c3f1-41ab-bce2-61c3d3752b3c=0";

  function goToSection1(user){
    const email = user?.email, uid = user?.uid;
    if(!email || !uid){ alert("Signed in, but missing email or UID."); return; }
    const url = `${S1_URL}?${S1_EMAIL_KEY}=${encodeURIComponent(email)}&${EXTRA_PARAM}&${S1_UID_KEY}=${encodeURIComponent(uid)}`;
    window.location.replace(url);
  }

  // Auto-forward returning users (skip the form if they’re already logged in)
  onAuthStateChanged(auth, (user) => {
    if (user) goToSection1(user);
  });

  // ------- Login -------
  document.getElementById('btnLogin')?.addEventListener('click', async () => {
    const email = document.getElementById('loginEmail')?.value.trim();
    const password = document.getElementById('loginPassword')?.value;
    if (!email || !password) return alert("Email and password are required.");
    try {
      const res = await signInWithEmailAndPassword(auth, email, password);
      goToSection1(res.user);
    } catch (err) {
      console.error(err);
      alert("Login failed. Check your email/password and try again.");
    }
  });

  // ------- Register -------
  document.getElementById('btnCreate')?.addEventListener('click', async () => {
    const first = document.getElementById('regFirst')?.value.trim();
    const last  = document.getElementById('regLast')?.value.trim();
    const email = document.getElementById('regEmail')?.value.trim();
    const password = document.getElementById('regPassword')?.value;
    const agreed = document.getElementById('agreeTos')?.checked;
    if (!email || !password) return alert("Email and password are required.");
    if (!agreed) return alert("Please agree to the Terms & Privacy.");

    try {
      const res = await createUserWithEmailAndPassword(auth, email, password);
      // Optional: set display name
      const displayName = [first, last].filter(Boolean).join(' ').trim();
      if (displayName) { try { await updateProfile(res.user, { displayName }); } catch(_) {} }
      goToSection1(res.user);
    } catch (err) {
      console.error(err);
      alert(err?.message || "Could not create account.");
    }
  });
</script>
  
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    updateProfile
  } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

  // --- Firebase (public client config) ---
  const firebaseConfig = {
    apiKey: "AIzaSyCcqBQtV3e1hGRMzBa_k5trNRqL0UmlByE",
    authDomain: "conciergesync.firebaseapp.com",
    projectId: "conciergesync",
    storageBucket: "conciergesync.firebasestorage.app",
    messagingSenderId: "882907448780",
    appId: "1:882907448780:web:6e797ce9ad5bb84a9f8969"
  };
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // --- Section-1 NoteForms prefill keys (yours) ---
  const S1_URL       = "https://noteforms.com/forms/beta-user-tracker-conciergesync-b4yxaf";
  const S1_EMAIL_KEY = "aafd8404-ef8a-4b17-ab3d-15e2357e93a5";
  const S1_UID_KEY   = "78ddd51d-9ccb-4fc7-a3cd-d17f7cd37ff4";
  const EXTRA_PARAM  = "b4eb726e-c3f1-41ab-bce2-61c3d3752b3c=0"; // keep

  function goToSection1(user){
    const email = user?.email, uid = user?.uid;
    if(!email || !uid){ alert("Signed in, but missing email/UID."); return; }
    const url = `${S1_URL}?${S1_EMAIL_KEY}=${encodeURIComponent(email)}&${EXTRA_PARAM}&${S1_UID_KEY}=${encodeURIComponent(uid)}`;
    window.location.replace(url);
  }

  // Auto-forward if already signed in
  onAuthStateChanged(auth, (user) => { if (user) goToSection1(user); });

  // ----- Log in -----
  document.getElementById('btnLogin')?.addEventListener('click', async () => {
    const email = document.getElementById('loginEmail')?.value.trim();
    const password = document.getElementById('loginPassword')?.value;
    if (!email || !password) return alert("Email and password are required.");
    try {
      const res = await signInWithEmailAndPassword(auth, email, password);
      goToSection1(res.user);
    } catch (e) {
      console.error(e);
      alert(e.code === 'auth/operation-not-allowed'
        ? 'Enable Email/Password in Firebase (Auth → Sign-in method).'
        : (e.message || 'Login failed.'));
    }
  });

  // ----- Register -----
  document.getElementById('btnCreate')?.addEventListener('click', async () => {
    const first = document.getElementById('regFirst')?.value.trim();
    const last  = document.getElementById('regLast')?.value.trim();
    const email = document.getElementById('regEmail')?.value.trim();
    const password = document.getElementById('regPassword')?.value;
    const agreed = document.getElementById('agreeTos')?.checked;
    if (!email || !password) return alert("Email and password are required.");
    if (!agreed) return alert("Please agree to the Terms & Privacy.");
    try {
      const res = await createUserWithEmailAndPassword(auth, email, password);
      const displayName = [first, last].filter(Boolean).join(' ').trim();
      if (displayName) { try { await updateProfile(res.user, { displayName }); } catch {} }
      goToSection1(res.user);
    } catch (e) {
      console.error(e);
      alert(e.code === 'auth/weak-password' ? 'Password must be at least 6 characters.' :
            e.code === 'auth/email-already-in-use' ? 'That email is already registered. Try logging in.' :
            (e.message || 'Could not create account.'));
    }
  });
</script>

</body>
</html>
