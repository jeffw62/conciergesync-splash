<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Welcome To ConciergeSync™</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
.cs-bg{
  position: fixed;
  inset: 0;
  background: url('/beta/assets/CS_Logo_Premium.png') center/500px repeat;
  opacity: 0.75;   /* keeps the gold pop but tones glare */
  z-index: 0;
  pointer-events: none;
}

  :root{ --glass:rgba(255,255,255,.10); --brd:rgba(255,255,255,.28); --blur:blur(12px) saturate(1.2) }
  html,body{height:100%}
  body{ margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:#fff; background:#0b1220; }
  /* .ov{position:fixed; inset:0; background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.60))} */

  .wrap{position:relative; min-height:100%; display:grid; place-items:center; padding:18px}
  .card{
    width:min(500px,92vw);
    border:1px solid var(--brd); background:var(--glass); backdrop-filter:var(--blur);
    border-radius:18px; padding:22px; box-shadow:0 12px 40px rgba(0,0,0,.35)
  }
  h1{margin:0 0 6px; font-weight:600; font-size:clamp(20px,4.2vw,36px); letter-spacing:-.01em; text-align:center}
  p.lead{text-align:center; margin:6px 0 16px; color:#e7ecf6; font-size:clamp(14px,2.2vw,16px)}
  .tabs{display:flex; gap:8px; justify-content:center; margin:0 0 14px}
  .tab{
    padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,.25);
    background:rgba(0,0,0,.25); cursor:pointer; font-weight:700; color:#fff; font-size:14px
  }
  .tab.is-active{background:#000;border-color:#000}

  .form{width:min(480px, 92vw); margin:0 auto; display:grid; gap:10px}
  .nameRow{ display:grid; grid-template-columns:1fr 1fr; gap:32px; }
  .nameRow > div{ min-width:0; }
  label{font-size:12px;color:#dbe2ee}
  input[type="text"],input[type="email"]{
    width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.24);
    background:rgba(0,0,0,.35);color:#fff;outline:none; font-size:14px
  }
  input[aria-invalid="true"]{ border-color:#ffb4b4; box-shadow:0 0 0 2px rgba(255,100,100,.25); }
  .row{display:flex;align-items:center;gap:8px;margin-top:2px}
  .err{color:#ffd0d0;font-size:12px;display:none;margin-top:6px}
  .actions{display:flex;gap:10px;align-items:center;margin-top:12px}
  button{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 14px;border-radius:999px;
    color:#111;font-weight:800;border:1px solid #fff;background:#fff;cursor:pointer;font-size:14px
  }
  .muted{color:#cdd3dd; font-size:12px; margin-top:10px}
  .status{color:#cdd3dd; font-size:12px; margin-top:8px; display:none}
  .status.show{display:block}
  @media (max-width:560px){ .nameRow{grid-template-columns:1fr; gap:12px} }
</style>
</head>
<body>
  <div class="cs-bg"></div>
  <div class="ov"></div>

  <div class="wrap">
    <div class="card">
      <h1>Welcome To ConciergeSync™</h1>
      <p class="lead">Sign in or create your account with your email.</p>

      <div class="tabs" role="tablist" aria-label="Choose mode">
        <button id="tabLogin" class="tab" role="tab" aria-selected="false">Returning user? Log in</button>
        <button id="tabReg"   class="tab is-active" role="tab" aria-selected="true">New user? Register</button>
      </div>

      <form id="gate" class="form" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" novalidate>
        <div class="nameRow" id="nameRow">
          <div>
            <label for="first">First name</label>
            <input id="first" name="cs_first" type="text" placeholder="First name"/>
            <div id="errFirst" class="err">Please enter your first name.</div>
          </div>
          <div>
            <label for="last">Last name</label>
            <input id="last" name="cs_last" type="text" placeholder="Last name"/>
            <div id="errLast" class="err">Please enter your last name.</div>
          </div>
        </div>

        <div>
          <label for="email">Email (your LoginID)</label>
          <input id="email" name="cs_email" type="email" placeholder="you@example.com" inputmode="email"/>
          <div id="errEmail" class="err">Please enter a valid email address.</div>
        </div>

        <div id="agreeRow">
          <label class="row">
            <input id="agree" name="cs_agree" type="checkbox" style="width:16px;height:16px">
            <span>I agree to the <a href="/beta/terms.html" target="_self" style="color:#fff;text-decoration:underline">Terms &amp; Privacy</a>.</span>
          </label>
          <div id="errAgree" class="err">You must agree to continue.</div>
        </div>

        <div class="actions">
          <button id="doSubmit" type="submit">Create account</button>
        </div>

        <div id="status" class="status">Working…</div>
        <div class="muted">Protected by rate-limiting and verification. We’ll never share your email.</div>
      </form>
    </div>
  </div>

<script type="module">
  // ——— Firebase Web SDK (v9+ modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // TODO: 🔧 paste your real Firebase config here
  const firebaseConfig = {
    apiKey: "AIzaSyCcqBQtV3e1hGRMzBa_k5trNRqL0UmlByE",
    authDomain: "conciergesync.firebaseapp.com",
    projectId: "conciergesync",
    storageBucket: "conciergesync.appspot.com",   // ← corrected
    messagingSenderId: "882907448780",
    appId: "1:882907448780:web:6e797ce9ad5bb84a9f8969"
  };

  // Init Firebase
  let app, db;
  try {
    app = initializeApp(firebaseConfig);
    db  = getFirestore(app);
  } catch (e) {
    console.warn("Firebase init error:", e);
  }

  // ——— Gate UI + Firestore integration
  const $ = s => document.querySelector(s);
  const mode = { value: 'register' };

  const tabLogin = $('#tabLogin'), tabReg = $('#tabReg');
  const nameRow = $('#nameRow'), agreeRow = $('#agreeRow');
  const first = $('#first'), last = $('#last'), email = $('#email'), agree = $('#agree');
  const errFirst = $('#errFirst'), errLast = $('#errLast'), errEmail = $('#errEmail'), errAgree = $('#errAgree');
  const form = $('#gate'), submitBtn = $('#doSubmit'), statusEl = $('#status');

  [first,last,email].forEach(i => { try{ i.value=''; }catch{} });

  function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
  function hide(el){ el.style.display='none'; }
  function show(el){ el.style.display='block'; }
  function clearErrors(){
    [first,last,email].forEach(i=>i.setAttribute('aria-invalid','false'));
    [errFirst,errLast,errEmail,errAgree].forEach(hide);
    statusEl.classList.remove('show');
  }
  function setWorking(on){
    submitBtn.disabled = on;
    submitBtn.style.opacity = on ? .7 : 1;
    statusEl.textContent = on ? 'Working…' : '';
    statusEl.classList.toggle('show', on);
  }

  function applyRequireds(){
    const login = mode.value === 'login';
    email.required = true;
    first.required = !login;
    last.required  = !login;
    agree.required = !login;
  }

  function setMode(m){
    mode.value = m;
    const login = m === 'login';
    tabLogin.classList.toggle('is-active', login);
    tabReg.classList.toggle('is-active', !login);
    tabLogin.setAttribute('aria-selected', login);
    tabReg.setAttribute('aria-selected', !login);
    nameRow.style.display = login ? 'none' : 'grid';
    agreeRow.style.display = login ? 'none' : 'block';
    submitBtn.textContent = login ? 'Log in' : 'Create account';
    [first,last].forEach(i => i.value='');
    clearErrors();
    applyRequireds();
  }
  tabLogin.addEventListener('click', ()=> setMode('login'));
  tabReg.addEventListener('click',   ()=> setMode('register'));
  applyRequireds(); // init

  ['input','change'].forEach(evt=>{
    [first,last,email,agree].forEach(el => el.addEventListener(evt, clearErrors));
  });

  function goConsole(){
    try{
      localStorage.setItem('cs_authed','1');
      sessionStorage.setItem('cs_authed','1');
    }catch{}
    location.replace('/beta/01-index.html?enter=1');
  }

  async function handleLogin(emailStr){
    const key = emailStr.toLowerCase().trim();
    if (!db){ show(errEmail); errEmail.textContent = 'Cannot reach database. Check Firebase config.'; return; }

    setWorking(true);
    try{
      const ref = doc(db, 'beta_users', key);
      const snap = await getDoc(ref);
      if (snap.exists()){
        setWorking(false);
        goConsole();
      } else {
        setWorking(false);
        show(errEmail);
        errEmail.textContent = 'We couldn’t find that email. Please register first.';
        email.setAttribute('aria-invalid','true');
        email.focus();
      }
    }catch(e){
      console.warn(e);
      setWorking(false);
      show(errEmail);
      errEmail.textContent = 'Login unavailable (rules or network).';
      email.setAttribute('aria-invalid','true');
    }
  }

  async function handleRegister(firstStr,lastStr,emailStr){
    const key = emailStr.toLowerCase().trim();
    if (!db){ show(errEmail); errEmail.textContent = 'Cannot reach database. Check Firebase config.'; return; }

    setWorking(true);
    try{
      const ref = doc(db, 'beta_users', key);
      await setDoc(ref, {
        first: firstStr.trim(),
        last:  lastStr.trim(),
        email: key,
        agreed: !!agree.checked,
        updatedAt: serverTimestamp(),
        createdAt: serverTimestamp()
      }, { merge: true });

      setWorking(false);
      goConsole();
    }catch(e){
      console.warn(e);
      setWorking(false);
      show(errEmail);
      errEmail.textContent = 'Registration unavailable (rules or network).';
      email.setAttribute('aria-invalid','true');
    }
  }

  function validate(){
    clearErrors();
    let ok = true, focusEl = null;
    const e = email.value.trim();

    if(!validEmail(e)){ ok=false; show(errEmail); errEmail.textContent='Please enter a valid email address.'; email.setAttribute('aria-invalid','true'); focusEl = focusEl || email; }

    if(mode.value !== 'login'){
      if(!first.value.trim()){ ok=false; show(errFirst); first.setAttribute('aria-invalid','true'); focusEl = focusEl || first; }
      if(!last.value.trim()){  ok=false; show(errLast);  last.setAttribute('aria-invalid','true');  focusEl = focusEl || last; }
      if(!agree.checked){ ok=false; show(errAgree); focusEl = focusEl || agree; }
    }
    if(!ok && focusEl){ try{ focusEl.focus(); }catch{} }
    return ok;
  }

  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();
    if(!validate()) return;

    const e = email.value.trim();
    if (mode.value === 'login'){
      await handleLogin(e);
    } else {
      await handleRegister(first.value, last.value, e);
    }
  });
</script>
</body>
</html>
