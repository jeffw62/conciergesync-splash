<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sign in — ConciergeSync™</title>
<style>
  :root{
    --card-bg: rgba(255,255,255,.08);
    --card-bd: rgba(255,255,255,.25);
    --glass: blur(12px) saturate(1.15);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    color:#eef2f8; background:#0b0f14;
  }
  /* Backdrop */
  .backdrop{position:fixed; inset:0; overflow:hidden; z-index:0}
  .backdrop:before{
    content:""; position:absolute; inset:0;
    background:url("/beta/assets/bg/IMG_5374.jpeg") center/cover no-repeat;
    filter:brightness(1.12) contrast(1.05);
    transform:scale(1.02);
  }
  .backdrop:after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(to bottom, rgba(0,0,0,.22), rgba(0,0,0,.55));
  }

  /* Card */
  .wrap{position:relative; z-index:1; min-height:100%; display:grid; place-items:center; padding:28px}
  .card{
    width:min(960px, 94vw);
    background:var(--card-bg); border:1px solid var(--card-bd); border-radius:16px;
    backdrop-filter:var(--glass);
    padding:28px; box-shadow:0 10px 32px rgba(0,0,0,.28);
  }
  h1{font-size:42px; line-height:1.15; margin:0 0 6px}
  p.lead{margin:0 0 18px; color:#cbd5e1}

  .row{display:flex; gap:12px; flex-wrap:wrap}
  input[type="email"]{
    flex:1 1 460px; min-width:280px;
    padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
    background:rgba(15,15,18,.65); color:#fff; outline:none;
  }
  input[type="email"]::placeholder{color:#9aa4b2}
  .btn{
    padding:14px 18px; border-radius:12px; font-weight:800; cursor:pointer; border:1px solid rgba(255,255,255,.55);
    background:#fff; color:#111;
  }
  .btn.ghost{background:transparent; color:#fff}
  .btn.linklike{background:transparent; color:#fff; border-color:rgba(255,255,255,.35)}
  .hint{margin-top:10px; color:#94a3b8; font-size:.95rem}

  .notice{
    margin-top:12px; padding:10px 12px; border-radius:12px;
    background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.22);
    display:none;
  }
  .notice.show{display:flex; gap:10px; justify-content:space-between; align-items:center; flex-wrap:wrap}
  .notice strong{color:#fff}
</style>
</head>
<body>

<div class="backdrop" aria-hidden="true"></div>

<div class="wrap">
  <div class="card" role="dialog" aria-labelledby="title" aria-describedby="desc">
    <h1 id="title">Sign in to ConciergeSync™</h1>
    <p id="desc" class="lead">Enter your email to continue to your console. <span style="opacity:.8">Passwordless during beta.</span></p>

    <div class="row" style="margin-bottom:8px">
      <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" aria-label="Email"/>
      <button id="enter" class="btn">Enter Console</button>
      <a class="btn ghost" href="/beta/01-index.html">What is ConciergeSync?</a>
    </div>

    <!-- Unknown email → persistent notice (no auto-redirect) -->
    <div id="unknown" class="notice" role="status" aria-live="polite">
      <div><strong>That email isn’t recognized for beta access yet.</strong> You can join now — it only takes a few minutes.</div>
      <div class="row" style="gap:8px">
        <a id="join" class="btn">Join the Beta</a>
        <button id="dismiss" class="btn linklike">Dismiss</button>
      </div>
    </div>

    <div class="hint">No bank logins required.</div>
  </div>
</div>

<script>
/* ---------- Config (optional allowlist) ---------- */
window.CS_ALLOWLIST = window.CS_ALLOWLIST || [];  // e.g. ['alice@company.com']

/* ---------- Helpers ---------- */
function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
function uidFromEmail(email){
  try{ return 'u_' + btoa(email.toLowerCase()).replace(/[^a-z0-9]/ig,'').slice(0,12); }
  catch(_){ return 'u_' + (Date.now().toString(36)); }
}
function setAuthed(email){
  const uid = uidFromEmail(email);
  sessionStorage.setItem('cs_authed','1');
  localStorage.setItem('cs_authed','1');
  sessionStorage.setItem('cs_email', email);
  localStorage.setItem('cs_email', email);
  sessionStorage.setItem('cs_uid', uid);
  localStorage.setItem('cs_uid', uid);
  document.cookie = 'cs_auth=1; path=/; max-age=7200; SameSite=Lax';
}
function isKnown(email){
  const e = email.toLowerCase().trim();
  const fromLocal = JSON.parse(localStorage.getItem('cs_known_users')||'[]');
  const seeded    = (window.CS_ALLOWLIST||[]).map(x=>String(x).toLowerCase().trim());
  return fromLocal.includes(e) || seeded.includes(e) || /@conciergesync\.ai$/i.test(e);
}

/* ---------- UI wiring ---------- */
const emailEl = document.getElementById('email');
const enterEl = document.getElementById('enter');
const joinEl  = document.getElementById('join');
const msgEl   = document.getElementById('unknown');
document.getElementById('dismiss').addEventListener('click', ()=> msgEl.classList.remove('show'));

/* Prefill from ?email= if present */
{
  const qs = new URLSearchParams(location.search);
  const qEmail = qs.get('email');
  if (qEmail) emailEl.value = qEmail;
}

/* Join beta goes to the onboarding splash (no console mode) */
joinEl.addEventListener('click', (e)=>{
  e.preventDefault();
  const email = (emailEl.value||'').trim();
  const url = '/beta/01-index.html' + (email ? ('?signup=1&email='+encodeURIComponent(email)) : '?signup=1');
  location.assign(url);
});

/* Returning sign-in (passwordless) */
function handleEnter(){
  const email = (emailEl.value||'').trim();
  if (!validEmail(email)){
    msgEl.querySelector('div').innerHTML = '<strong>Please enter a valid email address.</strong>';
    msgEl.classList.add('show');
    emailEl.focus();
    return;
  }

  if (isKnown(email)){
    setAuthed(email);
    /* Straight into the console with the flags the console expects */
    location.assign('/beta/01-index.html?enter=1&open=overview');
  } else {
    /* Unknown: show the notice and let them choose to join */
    msgEl.querySelector('div').innerHTML =
      '<strong>That email isn’t recognized for beta access yet.</strong> You can join now — it only takes a few minutes.';
    msgEl.classList.add('show');
  }
}

enterEl.addEventListener('click', (e)=>{ e.preventDefault(); handleEnter(); });
emailEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') handleEnter(); });
</script>
</body>
</html>
