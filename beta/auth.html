<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ConciergeSync â€” Sign in / Register</title>
  <style>
    :root{
      --vh: 100vh;
      --overlay: .30;
      --overlay-grad-top: rgba(0,0,0,.35);
      --overlay-grad-bottom: rgba(0,0,0,.55);

      --ink:#0f172a; --muted:#64748b;
      --ring: 0 0 0 3px rgba(255,255,255,.22);
      --glass-bg: rgba(255,255,255,.12);
      --glass-brd: rgba(255,255,255,.28);
      --glass-blur: blur(12px) saturate(1.2);
      --btn:#111; --btn-text:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:#f5f7fb; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:#000;
    }

    /* Backdrop (same system as console) */
    .backdrop{position:fixed; inset:0; height:var(--vh); overflow:hidden; z-index:0}
    .backdrop-image{
      position:absolute; inset:0; background:center/cover no-repeat;
      filter: brightness(1.12) contrast(1.05) blur(6px); transform: scale(1.03) translateZ(0);
      transition: opacity 600ms ease, transform 900ms ease, filter 900ms ease; opacity:0;
    }
    .backdrop-overlay{
      position:absolute; inset:0; pointer-events:none;
      background: linear-gradient(to bottom, var(--overlay-grad-top), var(--overlay-grad-bottom));
      opacity: var(--overlay); transition: opacity 220ms ease;
    }

    /* Layout */
    .wrap{position:relative; z-index:1; min-height:var(--vh); display:grid; place-items:center; padding:24px}
    .card{
      width:min(840px, 92vw);
      background: var(--glass-bg);
      border: 1px solid var(--glass-brd);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
      backdrop-filter: var(--glass-blur);
      padding: 28px;
    }

    h1{margin:0 0 8px; font-size:32px; text-align:center; letter-spacing:.2px}
    p.lead{margin:0 0 18px; text-align:center; color:#e7e9ef}

    /* Switch */
    .switch{display:flex; gap:8px; justify-content:center; margin:10px 0 22px}
    .switch button{
      padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.10); color:#fff; font-weight:700; cursor:pointer;
      backdrop-filter: blur(6px) saturate(1.1);
    }
    .switch button.active{background:#111; border-color:#111}

    form{display:grid; gap:12px; max-width:560px; margin:0 auto}
    label{font-weight:700; font-size:14px}
    input[type="email"], input[type="text"]{
      width:100%; padding:12px 14px; border-radius:12px;
      background: rgba(255,255,255,.14); color:#fff;
      border:1px solid rgba(255,255,255,.28);
    }
    input::placeholder{color:#dbe0ee}
    input:focus{outline:none; box-shadow:var(--ring); border-color:rgba(255,255,255,.5)}

    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:6px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 16px; border-radius:12px; border:1px solid var(--btn); background:var(--btn); color:var(--btn-text);
      font-weight:800; cursor:pointer;
    }
    .btn.secondary{background:transparent; color:#fff; border-color:rgba(255,255,255,.6)}
    .btn[disabled]{opacity:.6; cursor:not-allowed}

    .hint{color:#dbe0ee; font-size:13px}
    .legal{color:#cfd6ea; font-size:12px; text-align:center; margin-top:6px}
    .a{color:#fff; text-decoration:underline}

    /* OTP boxes */
    .sep{height:1px; background:rgba(255,255,255,.18); margin:16px 0}
    .otp{display:flex; gap:8px; justify-content:center}
    .otp input{
      width:48px; height:54px; text-align:center; font-size:22px;
      border-radius:12px; border:1px solid rgba(255,255,255,.28); background:rgba(255,255,255,.12); color:#fff;
    }

    @media (max-width:640px){
      .row{grid-template-columns:1fr}
      h1{font-size:26px}
    }
  </style>
<style>
  /* Force any password field in the login view to match the glass email input */
  #viewLogin input[type="password"],
  #viewLogin input#loginPassword,
  #viewLogin input#password {
    width: 100% !important;
    display: block !important;
    height: 44px !important;
    padding: 10px 14px !important;
    border-radius: 12px !important;
    border: 1px solid rgba(255,255,255,0.35) !important;
    background: rgba(255,255,255,0.12) !important;
    color: #fff !important;
    backdrop-filter: blur(10px) saturate(1.1) !important;
    -webkit-backdrop-filter: blur(10px) saturate(1.1) !important;
    box-shadow: 0 2px 8px rgba(0,0,0,.18) inset !important;
  }
  #viewLogin input[type="password"]:focus,
  #viewLogin input#loginPassword:focus,
  #viewLogin input#password:focus {
    outline: none !important;
    border-color: rgba(255,255,255,0.9) !important;
    box-shadow:
      0 0 0 3px rgba(255,255,255,0.18) inset,
      0 6px 18px rgba(0,0,0,.28) !important;
  }
</style>

</head>
<body>
  <!-- Backdrop -->
  <div class="backdrop">
    <div class="backdrop-image" id="bg"></div>
    <div class="backdrop-overlay"></div>
  </div>

  <div class="wrap">
    <div class="card" role="dialog" aria-labelledby="t">
      <h1 id="t">Welcome To ConciergeSyncâ„¢ ðŸ‘‹</h1>
      <p class="lead">Sign in or create your account with your email.</p>

      <div class="switch" role="tablist" aria-label="Auth mode">
        <button id="tab-login"  class="active" aria-selected="true">Returning user? Log in</button>
        <button id="tab-register" aria-selected="false">New user? Register</button>
      </div>

      <!-- LOGIN -->
      <!-- LOGIN (default) -->
<section id="viewLogin">
  <h1>Welcome To ConciergeSyncâ„¢</h1>
  <p>Sign in with your email and password.</p>

  <label>Email</label>
  <input id="loginEmail" type="email" autocomplete="username" required>

  <label>Password</label>
  <input id="loginPassword" type="password" autocomplete="current-password" required>

  <button id="btnLogin">Log in</button>

  <div style="margin-top:10px">
    <a id="linkShowRegister" href="#register">Not a member yet? Register here</a>
  </div>
</section>

<!-- REGISTER (hidden until clicked) -->
<section id="viewRegister" hidden>
  <h1>Create your account</h1>

  <div style="display:flex; gap:12px">
    <div style="flex:1">
      <label>First name</label>
      <input id="firstName" type="text" autocomplete="given-name">
    </div>
    <div style="flex:1">
      <label>Last name</label>
      <input id="lastName" type="text" autocomplete="family-name">
    </div>
  </div>

  <label>Email (your LoginID)</label>
  <input id="regEmail" type="email" autocomplete="username" required>

  <label>Create a password</label>
  <input id="regPassword" type="password" autocomplete="new-password" required>

  <label style="display:flex;gap:8px;align-items:center;margin:10px 0">
    <input id="agreeTos" type="checkbox" required>
    <span>I agree to the <a href="/terms.html" target="_blank">Terms</a> &amp; <a href="/privacy.html" target="_blank">Privacy</a>.</span>
  </label>

  <button id="btnCreate">Create account</button>

  <div style="margin-top:10px">
    <a id="linkShowLogin" href="#login">Already have an account? Log in</a>
  </div>
</section>

<script>
  // simple toggle between the two views
  const viewLogin = document.getElementById('viewLogin');
  const viewRegister = document.getElementById('viewRegister');
  document.getElementById('linkShowRegister')?.addEventListener('click', (e)=>{ e.preventDefault(); viewLogin.hidden = true; viewRegister.hidden = false; });
  document.getElementById('linkShowLogin')?.addEventListener('click', (e)=>{ e.preventDefault(); viewRegister.hidden = true; viewLogin.hidden = false; });
</script>


        <!-- OTP -->
        <div id="otp-wrap" style="display:none">
          <div class="sep"></div>
          <label>Enter the 6-digit code sent to your email</label>
          <div id="otp" class="otp" aria-label="One-time passcode">
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
            <input maxlength="1" inputmode="numeric" pattern="[0-9]*"/>
          </div>
          <div class="actions">
            <button class="btn" id="btn-verify" type="button">Verify &amp; continue</button>
            <button class="btn secondary" id="btn-resend" type="button">Resend code</button>
            <span id="otp-msg" class="hint" aria-live="polite"></span>
          </div>
        </div>
      </form>

      <!-- REGISTER -->
      <form id="form-register" style="display:none" autocomplete="on">
        <div class="row">
          <div>
            <label for="reg-first">First name</label>
            <input id="reg-first" name="firstName" type="text" autocomplete="given-name"/>
          </div>
          <div>
            <label for="reg-last">Last name</label>
            <input id="reg-last" name="lastName" type="text" autocomplete="family-name"/>
          </div>
        </div>
        <div>
          <label for="reg-email">Email (your LoginID)</label>
          <input id="reg-email" name="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" required/>
        </div>
        <div>
          <label><input id="reg-tos" type="checkbox" required/> I agree to the <a class="a" href="/legal/terms.html" target="_blank" rel="noopener">Terms</a> &amp; <a class="a" href="/legal/privacy.html" target="_blank" rel="noopener">Privacy</a>.</label>
        </div>
        <div class="actions">
          <button class="btn" id="btn-register" type="submit">Create account</button>
          <span id="reg-msg" class="hint" aria-live="polite"></span>
        </div>
      </form>

      <p class="legal">Protected by rate-limiting and verification. Weâ€™ll never share your email.</p>
    </div>
  </div>

  <script>
    // Backdrop (same approach as console)
    (function(){
      const IMAGES = ['/beta/assets/bg/IMG_5374.jpeg'];
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
                    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      function setVh(){ document.documentElement.style.setProperty('--vh', window.innerHeight + 'px'); }
      setVh(); addEventListener('resize', setVh);

      const bg = document.getElementById('bg');
      const src = IMAGES[0];
      const img = new Image(); img.crossOrigin = 'anonymous'; img.src = src;
      img.onload = ()=>{ bg.style.backgroundImage = `url("${src}")`; bg.style.opacity = 1; };
    })();

    // ====== Auth logic (same API shim as your console-side code) ======
    const API = {
      start:  '/api/auth/start',   // POST { mode:'login'|'register'|'link', email, profile? }
      verify: '/api/auth/verify',  // POST { tokenId, code }
    };
    const REDIRECT_AFTER_LOGIN = '/beta/02-agree.html?enter=1';

    const $ = (s,r=document)=>r.querySelector(s);
    const tabLogin=$('#tab-login'), tabReg=$('#tab-register');
    const formLogin=$('#form-login'), formReg=$('#form-register');
    function setMode(m){
      const isLogin = m==='login';
      tabLogin.classList.toggle('active', isLogin);
      tabReg.classList.toggle('active', !isLogin);
      formLogin.style.display = isLogin?'':'none';
      formReg.style.display   = isLogin?'none':'';
      (isLogin?$('#login-email'):$('#reg-email'))?.focus();
    }
    tabLogin.onclick=()=>setMode('login'); tabReg.onclick=()=>setMode('register');

    // LOGIN
    const loginMsg=$('#login-msg'), otpWrap=$('#otp-wrap'), otpMsg=$('#otp-msg');
    const otpBoxes = Array.from($('#otp-boxes').querySelectorAll('input'));
    let tokenId=null;

    formLogin.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = ($('#login-email').value||'').trim(); if(!email) return;
      loginMsg.textContent='Sending codeâ€¦'; $('#btn-send-code').disabled=true;
      try{
        const res = await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'login',email})});
        const data = await res.json(); if(!res.ok || !data?.ok) throw new Error(data?.error||'Failed to send code');
        tokenId=data.tokenId; otpWrap.style.display=''; loginMsg.textContent='Check your email for a 6-digit code.'; otpBoxes[0].focus();
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not send code'); }
      finally{ $('#btn-send-code').disabled=false; }
    });

    $('#btn-use-link').addEventListener('click', async ()=>{
      const email = ($('#login-email').value||'').trim(); if(!email) return alert('Enter your email first.');
      loginMsg.textContent='Sending magic linkâ€¦';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'link',email})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Failed to send link');
        loginMsg.textContent='Magic link sent â€” check your inbox.';
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not send link'); }
    });

    otpBoxes.forEach((b,i)=>{
      b.addEventListener('input',e=>{const v=b.value.replace(/\D/g,''); b.value=v.slice(-1); if(v && i<otpBoxes.length-1) otpBoxes[i+1].focus();});
      b.addEventListener('keydown',e=>{ if(e.key==='Backspace' && !b.value && i>0) otpBoxes[i-1].focus(); });
    });
    $('#btn-verify').onclick = async ()=>{
      if(!tokenId) return;
      const code = otpBoxes.map(b=>b.value).join(''); if(code.length!==6) return;
      otpMsg.textContent='Verifyingâ€¦';
      try{
        const res=await fetch(API.verify,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tokenId,code})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Invalid code');
        location.assign(REDIRECT_AFTER_LOGIN);
      }catch(err){ otpMsg.textContent=''; alert(err.message||'Could not verify code'); }
    };
    $('#btn-resend').onclick = async ()=>{
      const email = ($('#login-email').value||'').trim(); if(!email) return;
      loginMsg.textContent='Resending codeâ€¦';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'login',email})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Failed to resend code');
        tokenId=data.tokenId; loginMsg.textContent='New code sent.';
      }catch(err){ loginMsg.textContent=''; alert(err.message||'Could not resend code'); }
    };

    // REGISTER
    formReg.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const first=($('#reg-first').value||'').trim(), last=($('#reg-last').value||'').trim();
      const email=($('#reg-email').value||'').trim(); const agree=$('#reg-tos').checked;
      if(!email || !agree) return;
      $('#btn-register').disabled=true; $('#reg-msg').textContent='Creating your accountâ€¦';
      try{
        const res=await fetch(API.start,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({mode:'register',email,profile:{firstName:first,lastName:last}})});
        const data=await res.json(); if(!res.ok||!data?.ok) throw new Error(data?.error||'Could not create account');
        tokenId = data.tokenId ?? null;
        if(tokenId){
          // Finish with OTP the same as login:
          setMode('login'); $('#login-email').value=email; otpWrap.style.display=''; $('#login-msg').textContent='We emailed you a sign-in code to complete setup.'; otpBoxes[0].focus();
        }else{
          location.assign(REDIRECT_AFTER_LOGIN);
        }
      }catch(err){ alert(err.message||'Registration failed'); }
      finally{ $('#btn-register').disabled=false; $('#reg-msg').textContent=''; }
    });

    // Deep link: #register opens Register tab
    if(location.hash==='#register') setMode('register');
  </script>
</body>
</html>
