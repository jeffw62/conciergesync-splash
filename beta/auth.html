<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sign in — ConciergeSync™</title>
<style>
  :root{
    --card-bg: rgba(255,255,255,.08);
    --card-bd: rgba(255,255,255,.25);
    --glass: blur(12px) saturate(1.15);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    color:#eef2f8; background:#0b0f14;
  }
  /* Backdrop */
  .backdrop{position:fixed; inset:0; overflow:hidden; z-index:0}
  .backdrop:before{
    content:""; position:absolute; inset:0;
    background:url("/beta/assets/bg/IMG_5374.jpeg") center/cover no-repeat;
    filter:brightness(1.12) contrast(1.05);
    transform:scale(1.02);
  }
  .backdrop:after{
    content:""; position:absolute; inset:0;
    background:linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,.55));
  }

  /* Card */
  .wrap{position:relative; z-index:1; min-height:100%; display:grid; place-items:center; padding:28px}
  .card{
    width:min(880px, 92vw);
    background:var(--card-bg); border:1px solid var(--card-bd); border-radius:16px;
    backdrop-filter:var(--glass);
    padding:28px; box-shadow:0 10px 32px rgba(0,0,0,.28);
  }
  h1{font-size:42px; line-height:1.15; margin:0 0 6px}
  p.lead{margin:0 0 18px; color:#cbd5e1}

  .row{display:flex; gap:12px; flex-wrap:wrap}
  input[type="email"]{
    flex:1 1 420px; min-width:280px;
    padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.25);
    background:rgba(15,15,18,.65); color:#fff; outline:none;
  }
  input[type="email"]::placeholder{color:#9aa4b2}
  .btn{
    padding:14px 18px; border-radius:12px; font-weight:800; cursor:pointer; border:1px solid rgba(255,255,255,.55);
    background:#fff; color:#111;
  }
  .btn.ghost{background:transparent; color:#fff}
  .hint{margin-top:10px; color:#94a3b8; font-size:.95rem}
  .error{margin-top:10px; color:#fecaca; font-weight:700; display:none}
  .error.show{display:block}
</style>
</head>
<body>

<div class="backdrop" aria-hidden="true"></div>

<div class="wrap">
  <div class="card" role="dialog" aria-labelledby="title" aria-describedby="desc">
    <h1 id="title">Sign in to ConciergeSync™</h1>
    <p id="desc" class="lead">Enter your email to continue to your console.</p>

    <div class="row" style="margin-bottom:6px">
      <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" aria-label="Email"/>
      <button id="enter" class="btn">Enter Console</button>
      <a class="btn ghost" href="/beta/01-index.html">What is ConciergeSync?</a>
    </div>

    <div id="err" class="error">That email isn’t recognized for beta access yet. We’ll take you to onboarding to get set up.</div>
    <div class="hint">Passwordless during beta — just your email.</div>
  </div>
</div>

<script>
/* Optional: seed an allowlist here if you want.
   Example: window.CS_ALLOWLIST = ['alice@example.com','bob@company.com']; */
window.CS_ALLOWLIST = window.CS_ALLOWLIST || [];

/* Helper: tiny email check */
function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

/* Known-user check:
   - previously used on this browser (localStorage list)
   - seeded allowlist above
   - dev convenience: @conciergesync.ai */
function isKnown(email){
  const e = email.toLowerCase().trim();
  const fromLocal = JSON.parse(localStorage.getItem('cs_known_users')||'[]');
  const seeded    = (window.CS_ALLOWLIST||[]).map(x=>String(x).toLowerCase().trim());
  return fromLocal.includes(e) || seeded.includes(e) || /@conciergesync\.ai$/i.test(e);
}

/* Mark a user as known (you can also do this on your thank-you page after onboarding) */
function remember(email){
  const e = email.toLowerCase().trim();
  const list = new Set(JSON.parse(localStorage.getItem('cs_known_users')||'[]'));
  list.add(e);
  localStorage.setItem('cs_known_users', JSON.stringify([...list]));
}

/* Create a stable UID from email (non-crypto, fine for client-only beta state) */
function uidFromEmail(email){
  try{
    return 'u_' + btoa(email.toLowerCase()).replace(/[^a-z0-9]/ig,'').slice(0,12);
  }catch(_){
    return 'u_' + (Date.now().toString(36));
  }
}

/* Set beta “session” flags used by the console */
function setAuthed(email){
  const uid = uidFromEmail(email);
  sessionStorage.setItem('cs_authed','1');
  localStorage.setItem('cs_authed','1');
  sessionStorage.setItem('cs_email', email);
  localStorage.setItem('cs_email', email);
  sessionStorage.setItem('cs_uid', uid);
  localStorage.setItem('cs_uid', uid);
  document.cookie = 'cs_auth=1; path=/; max-age=7200; SameSite=Lax';
}

/* Wire up UI */
const emailEl = document.getElementById('email');
const enterEl = document.getElementById('enter');
const errEl   = document.getElementById('err');

/* Prefill from ?email= if present */
{
  const qs = new URLSearchParams(location.search);
  const qEmail = qs.get('email');
  if (qEmail) emailEl.value = qEmail;
}

function goReturning(email){
  setAuthed(email);
  // send directly into the console with the same state we use elsewhere
  location.assign('/beta/01-index.html?enter=1&open=overview');
}
function goOnboarding(email){
  // gentle message + route to splash (prefill email so they don’t retype)
  errEl.classList.add('show');
  // small pause so they can see the reason, then navigate
  setTimeout(()=>{
    location.assign('/beta/01-index.html?signup=1&email=' + encodeURIComponent(email));
  }, 500);
}

function handleEnter(){
  const email = (emailEl.value || '').trim();
  if (!validEmail(email)){
    errEl.textContent = 'Please enter a valid email.';
    errEl.classList.add('show');
    emailEl.focus();
    return;
  }
  errEl.classList.remove('show');

  if (isKnown(email)){
    goReturning(email);
  }else{
    // Treat as first-time: remember locally (so next time on this browser they’re known)
    remember(email);
    goOnboarding(email);
  }
}

enterEl.addEventListener('click', (e)=>{ e.preventDefault(); handleEnter(); });
emailEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') handleEnter(); });
</script>
</body>
</html>
